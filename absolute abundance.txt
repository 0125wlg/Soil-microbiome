
# 加载必要的包
if (!requireNamespace("tidyverse", quietly = TRUE)) {
  install.packages("tidyverse")
}
library(tidyverse)

# 读取OTU表
otu_data <- read_csv("JTTFActinomycetota.csv")

# 确认是否存在表示分类水平的列，例如'class'
# 如果没有，请替换为实际的分类水平列名
classification_level <- "genus" # 请根据实际情况修改此变量

# 读取分组信息
group_info <- read_csv("group_info.csv")

# 将OTU表转换为长格式，并合并分组信息
otu_data_long <- otu_data %>%
  pivot_longer(cols = -c(classification_level), names_to = "Sample", values_to = "Count") %>%
  left_join(group_info, by = c("Sample" = "sample"))

# 计算每组在每个分类水平上的绝对丰度
absolute_abundance <- otu_data_long %>%
  group_by_at(vars(c(classification_level, "group"))) %>%
  summarise(Total_Abundance = sum(Count, na.rm = TRUE))

# 查看结果
print(absolute_abundance)

# 如果需要保存结果
write.csv(absolute_abundance, "A_Abundance_Class_Level.csv", row.names = FALSE)
